<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Async tests | Inventory System </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Async tests | Inventory System ">
    
    
      <link rel="shortcut icon" href="../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../../../styles/docfx.css">
      <link rel="stylesheet" href="../../../../styles/main.css">
      <meta property="docfx:navrel" content="../../../../toc.html">
      <meta property="docfx:tocrel" content="../../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="Inventory System">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first=First data-prev=Previous data-next=Next data-last=Last></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="async-tests">Async tests</h1>

<p>You can use the dotnet Task asynchronous programming model to write asynchronous tests. If you're new to asynchronous programming and its applications, see the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/">Microsoft documentation</a> for a comprehensive guide. See also the documentation for NUnit <a href="https://docs.nunit.org/articles/nunit/writing-tests/attributes/test.html">Test</a>, which explains the requirements for an async test. Async code is run on the main thread and Unity Test Framework will <code>await</code> it by checking if the task is done on each <a href="https://docs.unity3d.com/ScriptReference/PlayerLoop.Update.html">update</a> for Play Mode or on each <a href="https://docs.unity3d.com/ScriptReference/EditorApplication-update.html">EditorApplication.update</a> outside Play Mode.</p>
<p>Note that any failing log messages will first be evaluated after the async test has completed. This means that if you have a failing log message in an async test, it will not be reported until the test has completed.</p>
<p>The following code snippet demonstrates an async test based on Microsoft's making breakfast example. Note that the test method is marked with the <code>async</code> keyword and has return type <code>Task</code>. We set up a list of Tasks corresponding to asynchronous methods representing parts of the breakfast making process. We use <code>await</code> to start these tasks in a non-blocking way, write to the log when each one completes, and write again to the log when all are completed.</p>
<pre><code>using System.Collections.Generic;
using System.Threading.Tasks;
using NUnit.Framework;
using UnityEngine;

public class AsyncExample
{
    [Test]
    public async Task MakeBreakfast_InTheMorning_IsEdible()
    {
        var eggsTask = FryEggsAsync(2);
        var baconTask = FryBaconAsync(3);
        var toastTask = MakeToastWithButterAndJamAsync(2);

        var breakfastTasks = new List&lt;Task&gt; { eggsTask, baconTask, toastTask };
        while (breakfastTasks.Count &gt; 0)
        {
            Task finishedTask = await Task.WhenAny(breakfastTasks);
            if (finishedTask == eggsTask)
            {
                Debug.Log(&quot;eggs are ready&quot;);
            }
            else if (finishedTask == baconTask)
            {
                Debug.Log(&quot;bacon is ready&quot;);
            }
            else if (finishedTask == toastTask)
            {
                Debug.Log(&quot;toast is ready&quot;);
            }
            breakfastTasks.Remove(finishedTask);
        }

        Debug.Log(&quot;Breakfast is ready!&quot;);
    }

    static async Task&lt;Toast&gt; MakeToastWithButterAndJamAsync(int number)
    {
        var toast = await ToastBreadAsync(number);
        ApplyButter(toast);
        ApplyJam(toast);

        return toast;
    }

    private static Juice PourOJ()
    {
        Debug.Log(&quot;Pouring orange juice&quot;);
        return new Juice();
    }

    private static void ApplyJam(Toast toast) =&gt;
        Debug.Log(&quot;Putting jam on the toast&quot;);

    private static void ApplyButter(Toast toast) =&gt;
        Debug.Log(&quot;Putting butter on the toast&quot;);

    private static async Task&lt;Toast&gt; ToastBreadAsync(int slices)
    {
        for (int slice = 0; slice &lt; slices; slice++)
        {
            Debug.Log(&quot;Putting a slice of bread in the toaster&quot;);
        }
        Debug.Log(&quot;Start toasting...&quot;);
        await Task.Delay(3000);
        Debug.Log(&quot;Remove toast from toaster&quot;);

        return new Toast();
    }

    private static async Task&lt;Bacon&gt; FryBaconAsync(int slices)
    {
        Debug.Log($&quot;putting {slices} slices of bacon in the pan&quot;);
        Debug.Log(&quot;cooking first side of bacon...&quot;);
        await Task.Delay(3000);
        for (int slice = 0; slice &lt; slices; slice++)
        {
            Debug.Log(&quot;flipping a slice of bacon&quot;);
        }
        Debug.Log(&quot;cooking the second side of bacon...&quot;);
        await Task.Delay(3000);
        Debug.Log(&quot;Put bacon on plate&quot;);

        return new Bacon();
    }

    private static async Task&lt;Egg&gt; FryEggsAsync(int howMany)
    {
        Debug.Log(&quot;Warming the egg pan...&quot;);
        await Task.Delay(3000);
        Debug.Log($&quot;cracking {howMany} eggs&quot;);
        Debug.Log(&quot;cooking the eggs ...&quot;);
        await Task.Delay(3000);
        Debug.Log(&quot;Put eggs on plate&quot;);

        return new Egg();
    }

    private static Coffee PourCoffee()
    {
        Debug.Log(&quot;Pouring coffee&quot;);
        return new Coffee();
    }

    public struct Toast
    {

    }

    public struct Juice
    {

    }

    public struct Bacon
    {

    }

    public struct Egg
    {

    }

    public struct Coffee
    {

    }
}
</code></pre>
<p>The following shows the result of running this example in the <strong>Test Runner</strong> window:</p>
<p><img src="./images/async.png" alt="Run async test example"></p>
<h2 id="editor-freezing-on-assertthrowsasync-and-workaround">Editor freezing on <code>Assert.ThrowsAsync</code> and workaround</h2>
<p>NUnit's assertion for asynchronous code, <a href="https://docs.nunit.org/articles/nunit/writing-tests/assertions/classic-assertions/Assert.ThrowsAsync.html">Assert.ThrowsAsync</a>, blocks the calling thread until the async function you pass in completes. By default Unity runs asynchronous functions on the main thread in case they need to call the Editor API, which means <code>Assert.ThrowsAsync</code> can lock up the main thread and cause the Editor to freeze.</p>
<p>To workaround this problem, you can unwrap the <code>Assert.ThrowsAsync</code> logic into your own <code>try</code>/<code>catch</code> blocks and assert that you caught something. For example, <strong>do</strong> this:</p>
<pre><code>[Test]
public async Task ThisDoesNotLockTheMainThread()
 {
  bool caught = false;
  try
  { 
    await Task.Delay(1000); throw new System.Exception(&quot;Hello world.&quot;); }
    catch (System.Exception x)
   {
     caught = true;
   }
   Assert.That(caught);
}
</code></pre>
<p><strong>Instead of</strong> this:</p>
<pre><code>[Test]
public void ThisLocksTheMainThread()
 {
  Assert.ThrowsAsync&lt;System.Exception&gt;(async () =&gt;
   { await Task.Delay(1000); throw new System.Exception(&quot;Hello world.&quot;); }
  );
}
</code></pre>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
