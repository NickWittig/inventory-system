<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>5. Collision Test | Inventory System </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="5. Collision Test | Inventory System ">
    
    
      <link rel="shortcut icon" href="../../../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../../../../../styles/docfx.css">
      <link rel="stylesheet" href="../../../../../../styles/main.css">
      <meta property="docfx:navrel" content="../../../../../../toc.html">
      <meta property="docfx:tocrel" content="../../../../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../../../../../index.html">
                <img id="logo" class="svg" src="../../../../../../logo.svg" alt="Inventory System">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first=First data-prev=Previous data-next=Next data-last=Last></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="5-collision-test">5. Collision Test</h1>

<h2 id="learning-objectives">Learning Objectives</h2>
<p>Check for collisions and make sure that LostCrypt does not have bugs that allow your character to move outside of the map.</p>
<h2 id="exercise">Exercise</h2>
<p>Take a look at a game object <code>Environment/Character Bounds - Left</code>. You can see that it is placed at the left side of our 2D map. It is meant to protect players from exiting the map and falling into textures. Let's see if it fulfills its purpose.</p>
<ol>
<li>Add a new test <code>MainScene\_CharacterDoesNotFallIntoTextures</code> in <code>MovementTest.cs</code>.</li>
<li>Make your character move left and occasionally jump with some wait interval in between jumps.</li>
<li>In test, Assert that <em>Sara Variant</em> game object position is within bounds of our current scene.</li>
</ol>
<h2 id="hints">Hints</h2>
<ul>
<li>Similarly to the previous test, let's set some arbitrary amount of seconds as our timeout. Sara should stay within the bounds of the scene for the given time.</li>
<li>You might want to use <code>WaitForSeconds(0.5f)</code> between jumps to emulate User behaviour better.</li>
<li>Study the Scene and hardcode X, and Y position used for out of map check, or better - get it dynamically from <code>Character Bounds - Left</code> game object.</li>
</ul>
<h2 id="solution">Solution</h2>
<p>MovementTest.cs</p>
<pre><code>using System.Collections;
using NUnit.Framework;
using UnityEngine;
using UnityEngine.TestTools;
using UnityEngine.SceneManagement;

public class MovementTest
{
    const float _testTimeout = 20.0f;
    private Transform _characterTransform;

    [UnityTest]
    public IEnumerator MainScene_CharacterDoesNotFallIntoTextures()
    {
        SceneManager.LoadScene(&quot;Assets/Scenes/Main.unity&quot;, LoadSceneMode.Single);
        yield return waitForSceneLoad();

        yield return GoLeft();
        while (Time.timeSinceLevelLoad &lt; _testTimeout)
        {
            yield return new WaitForSeconds(0.5f);
            yield return Jump();
            if (GetCurrentCharacterPosition().x &lt; -75f &amp;&amp; GetCurrentCharacterPosition().y &lt; -10f)
            {
                Assert.Fail(&quot;Character escaped the map and fell into textures! :(&quot;);
            }
        }
    }

    private Vector3 GetCurrentCharacterPosition()
    {
        // Get Main character's Transform which is used to manipulate position.
        if (_characterTransform == null)
        {
            _characterTransform = GameObject.Find(&quot;Sara Variant&quot;).transform;
        }

        return _characterTransform.position;
    }

    private IEnumerator Jump()
    {
        TestInputControl.Jump = true;
        yield return null;
        TestInputControl.Jump = false;
    }

    private IEnumerator GoLeft()
    {
        TestInputControl.MoveRight = false;
        yield return null;
        TestInputControl.MoveLeft = true;
    }

    private IEnumerator waitForSceneLoad()
    {
        while (SceneManager.GetActiveScene().buildIndex &gt; 0)
        {
            yield return null;
        }
    }
}
</code></pre>
<p>Our test fails, we have a bug in one of our Sample Unity projects. How would you approach fixing this problem? There are plenty of possibilities, go ahead and try to fix it as part of this training:</p>
<ul>
<li>Introduce new Character Bounds Box collider that will prevent the bug from happening.</li>
<li>Rework our Sara character collision logic.</li>
</ul>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../../../../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../../../styles/main.js"></script>
  </body>
</html>
